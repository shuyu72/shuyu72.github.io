<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>移動方塊</title>
        <canvas id="canvas"></canvas>
    </head>
    <body>
        <script type="text/javascript">
            function callCamera() {
                if ('mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices) {
                    console.log("Let's get this party started")
                }
                navigator.mediaDevices.getUserMedia({video: true});
            }
            
            function draw (id){            
            //獲取畫布id
            var canvas =document.getElementById(id);
            canvas.width  = document.body.clientWidth;//window.innerWidth;//getWidth();
  			canvas.height = getHeight();//document.body.clientHeight;//window.innerHeight;
            if(canvas==null)
                return false;
            //獲取上下文
            var  cxt =canvas.getContext("2d");            
            // randTime = Math.floor(Math.random() * 10 + 10);
            //var interval=setInterval(function(){move(cxt);},randTime);
            (function loop() {
                var randTime = Math.floor(Math.random() * 100 + 5);
                // var rand = Math.round(Math.random() * (3000 - 500)) + 500;
                    setTimeout(function() {
                    move(cxt);
                    loop();  
                }, randTime);
            }());
            }
            randX = 0;//Math.floor(Math.random() * getWidth());
            randY = 0;//Math.floor(Math.random() * getHeight());
            randMl= Math.floor(Math.random() * 10);
            var x=[];//randX;//矩形的x座標
            var y=[];//randY;//矩形的y座標
            var mx=[];//值為0向右，值為0向左
            var my=[];//值為0向下，值為0向上
            var ml=randMl;//移動的長度
            var w=20;//矩形的寬
            var h=20;//矩形的高
            var cw=document.body.clientWidth;//getWidth();//畫布的寬
            var ch=getHeight();//document.body.clientHeight;//畫布的高

            function initMXMY(size){
                for(i=0;i<size;i++){
                    mx.push(0);
                    my.push(0);
                }
            }

            function genXYArr(size){
                for(i=0;i<size;i++){
                    x.push(Math.floor(Math.random() * document.body.clientWidth));
                    y.push(Math.floor(Math.random() * getHeight()));
                }
            }
            
            function getWidth() {
                return Math.max(
                    document.body.scrollWidth,
                    document.documentElement.scrollWidth,
                    document.body.offsetWidth,
                    document.documentElement.offsetWidth,
                    document.documentElement.clientWidth
                );
            }

            function getHeight() {
                return Math.max(
                    document.body.scrollHeight,
                    document.documentElement.scrollHeight,
                    document.body.offsetHeight,
                    document.documentElement.offsetHeight,
                    document.documentElement.clientHeight
                );
            }
           
           function move(cxt){               
               cxt.clearRect(0,0,getWidth(),getHeight());//在給定的矩形內清除所有的畫素為透明
               cxt.fillStyle="#EEEEFF";//把填充顏色設定為指定的顏色
               cxt.fillRect(0,0,getWidth(),getHeight());//是用當前的填充風格填充指定的區域
               cxt.fillStyle="red";//把矩形設定為紅色
               var size=50;
               initMXMY(size);
               genXYArr(size);
               for(i=0;i<size;i++){
                    cxt.fillRect(x[i],y[i],w,h);//繪製矩形                
                    //判斷是否到達邊緣
                    if(mx[i]==0){
                        x[i]=x[i]+ml;//x座標加上移動長度
                        if(x[i]>cw-w){
                            mx[i]=1;
                        }
                    }else{
                        x[i]=x[i]-ml;
                        if(x[i]<=0){
                            mx[i]=0;                       
                        }
                    }
                    if(my[i]==0){
                        y[i]=y[i]+ml;
                        if(y[i]>ch-h){
                            my[i]=1;
                        }
                    }else{
                        y[i]=y[i]-ml;
                        if(y[i]<=0){
                            my[i]=0;                       
                        }
                    }
           }
        }              
           window.addEventListener("DOMContentLoaded",draw("canvas"),true);
           callCamera();
        </script>
    </body>
</html>
