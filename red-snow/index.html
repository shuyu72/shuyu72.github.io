<!DOCTYPE html>

<html lang="en">
    <head>
        
        <meta name="viewport" content="width=100%, initial-scale=1.1, user-scalable=no" />
        <script src="html5-qrcode.min.js"></script>
        <script src="index.js"></script>
        <script src="https://raw.githubusercontent.com/mebjas/html5-qrcode/master/minified/html5-qrcode.min.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css" integrity="sha256-gsmEoJAws/Kd3CjuOQzLie5Q3yshhvmo7YNtBG7aaEY=" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>   
    </head>
    <body>
        <h1 id="result"></h1>
        <div class="row" id="btnGrp">            
            <div class="col-2 col-xs-2"></div>
            <div class="btn btn-success" id="todayDataDownload" onclick="downloadDateClickEvent(todayWithoutSlash)" hidden="true">當前資料下載</div>
            <!-- <label class="checkbox mx-2">
                <input type="checkbox" id="enableAuto" checked="true" />三秒後自動送出enter
            </label> -->
            <div class="col-2 col-xs-2"></div>  
        </div>
        <div id="panel"></div>
        <div class="container">
        <div class="float-left my-5"> <!--text-center-->  
        </div>
        <div class="row my-3 d-flex float-left"><!--justify-content-center text-center-->
            
            <div class="float-left my-0 row d-inline-block"> <!--text-center justify-content-center-->
            <div id="orderIdGrp" class="row mx-1 col-12">
                <h5 class="my-1 mx-0 col-2 col-xs-2 col-sm-2 col-md-2 col-lg-2">單號:</h5>                
            <!-- </div> -->
                <h5 class="my-1 mx-0 col-7 col-xs-7 col-sm-7 col-md-7 col-lg-7" id="orderIdH5" hidden="true"></h5>
                <div class="btn btn-danger px-3 reset-input col-1" id="orderIdclear" onclick="modifyOrderId()" hidden="true">×</div>
                <div class="mx-0 input-group col-9 col-xs-9 col-sm-9 col-md-9 col-lg-9">                    
                        <input class="form-control mx-0" type="text" id="orderIdInput" placeholder="掃描或輸入單號"/>
                        <div class="input-group-append">                
                            <div class="btn btn-primary mx-0 px-1" id="ensureOrderIdBtn" onclick="newOrder()">確認</div>
                        </div>
                        <div class="input-group-append">                
                            <div class="btn btn-warning mx-0 px-1" id="scanOrderIdBtn" onclick="showScanner()">掃描</div>
                        </div>                    
                </div>
                <!-- <div class="row table-row text-center"> -->
            <div id="qr-reader" class="col-xs-12 my-1" style="width:100%;" hidden="true"></div>
            <div id="qr-reader-results"></div>
            <div class="float-left my-2 row col-12"><!--text-center justify-content-center-->
                <div class="col-2 col-xs-2 col-sm-2 col-md-2 col-lg-2"></div>
                <div class="mx-0 input-group col-10 col-xs-10 col-sm-10 col-md-10 col-lg-10">
                    <input type="text" class="form-control ml-1" placeholder="掃描或輸入條碼" id="inputBarCode"/>
                    <div class="input-group-append">                
                        <div class="btn btn-danger px-1 reset-input" onclick="clearInput('inputBarCode')">×</div>
                    </div>
                    <div class="input-group-append">                
                        <div class="btn btn-primary px-3" id="ensureNewRecord" onclick="newRecord()">確認</div>
                    </div>                
                </div>        
                </div>
        </div>    
        <div class="mx-1 text-center justify-content-center"><!--float-xs-left-->            
            <div class="container">
                <br>            
                  <div class="text-center table-wrapper">                                                  
                    <table class="table">
                      <thead>
                        <tr>
                          <th class="col-xs-1">項次</th>                      
                          <th class="col-xs-2">品名</th>
                          <th class="col-xs-2">暗記</th>                                                
                          <th class="col-xs-2">移除</th>
                        </tr>
                      </thead>
                      <tbody>                    
                      </tbody>
                    </table>
                  </div>
                </div>    
            </div>
                    
            <div id="fixedButtons" class="row my-5 mx-0 inline-block">
                <!-- <div class="col-3 col-md-3"></div>         -->
                <div class="col-6 col-md-6">
                    <div class="btn btn-info" onclick="confirmClearThis()">重置</div>
                </div>
                <div class="col-6 col-md-6">                
                    <div class="btn btn-danger" onclick="end()">完成</div>
                </div>
                <!-- <div class="col-3 col-md-3"></div>         -->
            </div>
        </div>
        
        
        
        <!-- </div> -->
        
    <!-- </div> -->
    
        </div>
</div>
</div>
    <script>
        const product_json = '[ { "ProductName": "維奇葡萄糖胺玫瑰果升級配方20公克/包", "ProductNumber": "LA08903", "EAN": null }, { "ProductName": "佳倍優糖尿病配方40公克*18包/盒", "ProductNumber": "LA06305", "EAN": "4711542360403" }, { "ProductName": "維維樂佳慎營養配方(1) 840公克/罐", "ProductNumber": "LA05601", "EAN": "4711542360373" }, { "ProductName": "(STP)維維樂佳慎營養配方(1) 30公克/包", "ProductNumber": "LA05602", "EAN": "4711542360380" }, { "ProductName": "維奇益慎補營養配方(1) 900公克/罐", "ProductNumber": "LA05603", "EAN": "4710285004322" }, { "ProductName": "(STP)維奇益慎補營養配方(1) 30公克/包", "ProductNumber": "LA05604", "EAN": "4710285004339" }, { "ProductName": "(外銷)維奇鉻活力高鈣營養飲品15公克/包", "ProductNumber": "LA04305", "EAN": "LA4309" }, { "ProductName": "(外銷)維奇全家鈣益菌營養強化奶粉 15公克/包", "ProductNumber": "LA06502", "EAN": null }, { "ProductName": "(外銷)維奇貝兒幼兒成長奶粉(3)900公克/罐", "ProductNumber": "LA00603", "EAN": "4710285007644" }, { "ProductName": "(外銷)維奇貝兒兒童強化奶粉(4) 900公克/罐", "ProductNumber": "LA01101", "EAN": "4710285007651" }, { "ProductName": "(外銷)維奇貝兒兒童強化奶粉(4)樣品包 15公克/包", "ProductNumber": "LA01102", "EAN": "4710285007668" }, { "ProductName": "(外銷)維奇貝兒幼兒成長奶粉(3)樣品包 15公克/包", "ProductNumber": "LA00604", "EAN": "4710285007675" }, { "ProductName": "(STP)維維樂沛體素Plus營養配方800公克/罐", "ProductNumber": "LA07801", "EAN": "4711542360847" }, { "ProductName": "(STP)維奇福體康Plus營養配方840公克/罐", "ProductNumber": "LA07803", "EAN": "4710285007682" }, { "ProductName": "(STP)維維樂沛體素Plus營養配方40公克/包", "ProductNumber": "LA07802", "EAN": "4711542360854" }, { "ProductName": "(STP)維奇福體康Plus營養配方40公克/包", "ProductNumber": "LA07804", "EAN": "4710285007699" }, { "ProductName": "(外銷)維奇全素養生素 900公克/罐", "ProductNumber": "LA03101", "EAN": "4710285002045" }, { "ProductName": "GKC 鉻利穩 920公克/罐", "ProductNumber": "LA04307", "EAN": "4710285007859" }, { "ProductName": "維維樂葡萄糖胺高鈣全素減糖配方900公克/罐", "ProductNumber": "LA07901", "EAN": "4711542360946" }, { "ProductName": "維奇金優蛋白素 720公克/罐", "ProductNumber": "LA06903", "EAN": "4710285006432" }, { "ProductName": "維維樂葡萄糖胺高鈣全素減糖配方 30公克/包", "ProductNumber": "LA07902", "EAN": "4711542360953" }, { "ProductName": "GKC 鉻利穩 30公克/包", "ProductNumber": "LA04308", "EAN": "4710285007927" }, { "ProductName": "維奇鉻活力高鈣營養飲品920公克/罐", "ProductNumber": "LA04301", "EAN": "4710285002953" }, { "ProductName": "維維樂優蛋白素 720公克/罐", "ProductNumber": "LA06901", "EAN": "4711542360175" }, { "ProductName": "維維樂全素+鉻補養素 920公克/罐", "ProductNumber": "LA08001", "EAN": "4711542360984" }, { "ProductName": "維維樂全素+鉻補養素 30公克/包", "ProductNumber": "LA08002", "EAN": null }, { "ProductName": "(外銷)維奇成人補養素 900公克/罐", "ProductNumber": "LA02302", "EAN": "4710285001734" }, { "ProductName": "(外銷)維奇鉻活力高鈣營養飲品920公克/罐", "ProductNumber": "LA04306", "EAN": "4710285002953" }, { "ProductName": "(外銷)維奇全家鈣益菌營養強化奶粉1350公克/罐", "ProductNumber": "LA06503", "EAN": "4710285006081" }, { "ProductName": "(外銷)維奇葡萄糖胺全素高鈣升級配方800公克/罐", "ProductNumber": "LA06404", "EAN": "4710285005954" }, { "ProductName": "(外銷)維奇金優蛋白素 720公克/罐", "ProductNumber": "LA06906", "EAN": "4710285006432" }, { "ProductName": "維奇葡萄糖胺全素高鈣升級配方810公克/罐", "ProductNumber": "LA06401-1", "EAN": "4710285005954" }, { "ProductName": "GKC 雙優蛋白葉黃素配方 750公克/罐", "ProductNumber": "LA08201", "EAN": "4710285008146" }, { "ProductName": "GKC 葉黃素優蛋白 30公克/包", "ProductNumber": "LA08202", "EAN": null }, { "ProductName": "維奇葡萄糖胺全素高鈣升級配方1350公克/罐", "ProductNumber": "LA06405", "EAN": "4710285005435" }, { "ProductName": "維維樂葡萄糖胺高鈣全素養生素 1650公克/罐", "ProductNumber": "LA06703", "EAN": "4710285005442" }, { "ProductName": "GKC葡萄糖胺高鈣高纖配方 810公克/罐", "ProductNumber": "LA06706", "EAN": "4710285006753" }, { "ProductName": "維維樂4益菌補養素高鈣 1620公克/罐", "ProductNumber": "LA06601", "EAN": "4711542360182" }, { "ProductName": "維奇鉻活力高鈣營養配方(胚芽)920公克/罐", "ProductNumber": "LA06201", "EAN": "4710285005916" }, { "ProductName": "博能關康健補養素 810公克/罐", "ProductNumber": "LA07101", "EAN": "4710285007354" }, { "ProductName": "佳倍優糖尿病配方40公克*24包/盒(N)", "ProductNumber": "LA06306", "EAN": "4711542360281" }, { "ProductName": "維奇幼兒成長奶粉 900公克/罐", "ProductNumber": "LA00601", "EAN": "4710285000737" }, { "ProductName": "(外銷)維奇幼兒成長奶粉 1800公克/罐", "ProductNumber": "LA00602", "EAN": "4710285001253" }, { "ProductName": "(外銷)維維樂優質成長奶粉 1800公克/罐", "ProductNumber": "LA00801", "EAN": "4710285000850" }, { "ProductName": "(外銷)博能幼兒成長奶粉 900公克/罐", "ProductNumber": "LA01201", "EAN": null }, { "ProductName": "(STP)維維樂成人補養素900公克/罐", "ProductNumber": "LA02201", "EAN": "4710285002649" }, { "ProductName": "維奇成人補養素 900公克/罐", "ProductNumber": "LA02301", "EAN": "4710285001734" }, { "ProductName": "(外銷)維奇成人補養素15公克/包", "ProductNumber": "LA02305", "EAN": null }, { "ProductName": "(外銷)GKC成人補養素 900公克/罐", "ProductNumber": "LA02303", "EAN": "4710285005817" }, { "ProductName": "(外銷)維維樂兒童強化奶粉 1800公克/罐", "ProductNumber": "LA02601", "EAN": "4710285001819" }, { "ProductName": "(外銷)維奇優質羊奶粉 1000公克/罐", "ProductNumber": "LA02702", "EAN": "4710285001987" }, { "ProductName": "(外銷)維維樂PB益菌羊奶粉 1000公克/罐", "ProductNumber": "LA02701", "EAN": "4711542360151" }, { "ProductName": "(外銷)維奇優質羊奶粉 樣品包 15公克/包", "ProductNumber": "LA02703", "EAN": null }, { "ProductName": "(外銷)維維樂成人高鈣奶粉 1800公克/罐", "ProductNumber": "LA03002", "EAN": "4710285002038" }, { "ProductName": "(外銷)維奇全素養生素 15公克/包", "ProductNumber": "LA03104", "EAN": null }, { "ProductName": "(外銷)維維樂全素養生素 900公克/罐", "ProductNumber": "LA03601", "EAN": "4710285002632" }, { "ProductName": "維維樂+鉻補養素 1000公克/罐", "ProductNumber": "LA04201", "EAN": "4710285002809" }, { "ProductName": "維維樂+鉻補養素 30公克/包", "ProductNumber": "LA04202", "EAN": "4710285002960" }, { "ProductName": "維維樂+鉻補養素 40公克/包", "ProductNumber": "LA04204", "EAN": "4710285002816" }, { "ProductName": "維維樂+鉻補養素40公克*16包/盒", "ProductNumber": "LA04205", "EAN": "4710285002915" }, { "ProductName": "維維樂+鉻補養素 1800公克/罐", "ProductNumber": "LA04206", "EAN": "4710285004674" }, { "ProductName": "維奇鉻活力高鈣營養飲品30公克/包", "ProductNumber": "LA04302", "EAN": "4710285003356" }, { "ProductName": "維奇鉻活力高鈣營養飲品1800公克/罐", "ProductNumber": "LA04304", "EAN": "4710285004681" }, { "ProductName": "維維樂+鉻補養素蘋果light風味 1000公克/罐", "ProductNumber": "LA04401", "EAN": "4710285003028" }, { "ProductName": "維維樂+鉻補養素蘋果light風味 30公克/包", "ProductNumber": "LA04402", "EAN": "4710285003035" }, { "ProductName": "維維樂+鉻補養素蘋果light風味 1800公克/罐", "ProductNumber": "LA04403", "EAN": "4711542360120" }, { "ProductName": "(外銷)維維樂優質媽咪奶粉 900公克/罐", "ProductNumber": "LA04805", "EAN": "4710285004315" }, { "ProductName": "(外銷)維奇媽媽奶粉 900公克/罐", "ProductNumber": "LA04806", "EAN": "4710285004711" }, { "ProductName": "博能生機關常健葡萄糖胺高鈣(無添加糖)800公克/罐", "ProductNumber": "LA05701", "EAN": "4710285005565" }, { "ProductName": "(外銷)維維樂睡前養身素 900公克/罐", "ProductNumber": "LA06001", "EAN": "4711542360144" }, { "ProductName": "維奇鉻活力高鈣營養配方(胚芽) 30公克/包", "ProductNumber": "LA06202", "EAN": "4710285005992" }, { "ProductName": "維奇葡萄糖胺全素高鈣升級配方30公克/包", "ProductNumber": "LA06402", "EAN": "4710285005985" }, { "ProductName": "維奇全家鈣益菌PLUS 1350公克/罐", "ProductNumber": "LA06501", "EAN": "4710285006081" }, { "ProductName": "維維樂葡萄糖胺高鈣全素養生素 900公克/罐", "ProductNumber": "LA06701", "EAN": "4711542360069" }, { "ProductName": "(外銷)維維樂多種水果米粉 450公克/罐", "ProductNumber": "LB00301", "EAN": "4710285001710" }, { "ProductName": "(外銷)維奇成長水果米粉 450公克/罐", "ProductNumber": "LB00401", "EAN": "4710285001727" }, { "ProductName": "(外銷)博能黃金時光水果米粉 450公克/罐", "ProductNumber": "LB00404", "EAN": "4710285005541" }, { "ProductName": "(外銷)GKC 成長米粉 450公克/罐", "ProductNumber": "LB00402", "EAN": "4710285005800" }, { "ProductName": "(外銷)維奇貝兒嬰兒奶粉(1) 900公克/罐", "ProductNumber": "LA07202", "EAN": "9421004013697" }, { "ProductName": "(外銷)維奇貝兒較大嬰兒奶粉(2) 900公克/罐", "ProductNumber": "LA07302", "EAN": "9421004013703" }, { "ProductName": "(外銷)維維樂嬰兒奶粉(1) 900公克/罐", "ProductNumber": "LA07401", "EAN": "9421004013758" }, { "ProductName": "(外銷)維維樂較大嬰兒奶粉(2) 900公克/罐", "ProductNumber": "LA07501", "EAN": "9421004013765" }, { "ProductName": "超值飲品組(粉-優質蛋白飲*2)", "ProductNumber": "LA06907", "EAN": null }, { "ProductName": "(外銷)維特兒童營養素 900公克/罐", "ProductNumber": "LA01501", "EAN": "4710285006883" }, { "ProductName": "(外銷)GKC金寶幼兒奶粉 900公克/罐", "ProductNumber": "LA07001", "EAN": "4710285006951" }, { "ProductName": "(外銷)GKC全家鈣四益菌營養強化奶粉 1350公克/罐", "ProductNumber": "LA06504", "EAN": "4710285006968" }, { "ProductName": "(外銷)GKC孕寶媽媽奶粉 900公克/罐", "ProductNumber": "LA04802", "EAN": "4710285006760" }, { "ProductName": "(外銷)GKC全素養生素 900公克/罐", "ProductNumber": "LA03102", "EAN": "4710285006777" }, { "ProductName": "維維樂優蛋白素 30公克/包", "ProductNumber": "LA06902", "EAN": null }, { "ProductName": "維奇金優蛋白素 30公克/包", "ProductNumber": "LA06904", "EAN": null }, { "ProductName": "博能生機佳倍穩100鉻配方 750公克/罐", "ProductNumber": "LA06203", "EAN": "4710285006999" }, { "ProductName": "(STP)博能生機佳倍穩100鉻配方 40公克/包", "ProductNumber": "LA06204", "EAN": null }, { "ProductName": "GKC葡萄糖胺高鈣高纖配方 30公克/包", "ProductNumber": "LA06707", "EAN": "LA6742" }, { "ProductName": "博能生機關常健葡萄糖胺高鈣(無添加糖)30公克/包", "ProductNumber": "LA05702", "EAN": "4710285007309" }, { "ProductName": "維維樂葡萄糖胺高鈣全素養生素 30公克/包", "ProductNumber": "LA06702", "EAN": "4710285008184" }, { "ProductName": "(外銷)維特高鈣葡萄糖胺全素優質配方800公克/罐", "ProductNumber": "LA06408", "EAN": "4710285006739" }, { "ProductName": "博能生機優蛋白素A+高纖鈣配方 700公克/罐", "ProductNumber": "LA06908", "EAN": "4710285005718" }, { "ProductName": "博能生機優蛋白素A+高纖鈣配方700公克2罐入", "ProductNumber": "LA06909", "EAN": "4710285005725" }, { "ProductName": "維奇金幼兒成長配方 900公克/罐", "ProductNumber": "LA07005", "EAN": "4710285006265" }, { "ProductName": "(外銷)博能優質媽咪奶粉 900公克/罐", "ProductNumber": "LA04803", "EAN": "4710285006388" }, { "ProductName": "佳倍優均衡補體配方29公克/包", "ProductNumber": "LA04903", "EAN": "4711542360472" }, { "ProductName": "佳倍優均衡補體配方29公克*18包/盒", "ProductNumber": "LA04902-1", "EAN": "4711542360458" }, { "ProductName": "佳倍優均衡補體配方29公克*24包/盒", "ProductNumber": "LA04901-1", "EAN": "4711542360441" }, { "ProductName": "ACE金幼童成長配方 40公克/包", "ProductNumber": "LA07002", "EAN": "4710285008719" }, { "ProductName": "(外銷)維特成長水果米粉 450公克/罐", "ProductNumber": "LB00403", "EAN": "4710285008726" }, { "ProductName": "(外銷)維特優質媽咪奶粉 900公克/罐", "ProductNumber": "LA04804", "EAN": "4710285008733" }, { "ProductName": "(外銷)博能生機優蛋白素A+高纖鈣配方700公克/罐", "ProductNumber": "LA06911", "EAN": "4710285005718" }, { "ProductName": "佳倍優糖尿病配方 27公克/包", "ProductNumber": "LA06301", "EAN": "4711542360304" }, { "ProductName": "佳倍優糖尿病配方 40公克/包", "ProductNumber": "LA06302", "EAN": "4711542360311" }, { "ProductName": "維維樂力補素均衡高鈣配方29公克/包", "ProductNumber": "LA04904", "EAN": "4710285010149" }, { "ProductName": "維維樂力補素均衡高鈣配方850公克/罐", "ProductNumber": "LA04905", "EAN": "4710285010156" }, { "ProductName": "維維樂+鉻補養素PLUS 800公克/罐", "ProductNumber": "LA08801", "EAN": "4710285010378" }, { "ProductName": "(STP)維維樂+鉻補養素PLUS 30公克/包", "ProductNumber": "LA08802", "EAN": null }, { "ProductName": "維奇葡萄糖胺玫瑰果升級配方840公克/罐", "ProductNumber": "LA08901", "EAN": "4710285010385" }, { "ProductName": "維奇葡萄糖胺玫瑰果升級配方30公克/包", "ProductNumber": "LA08902", "EAN": null }, { "ProductName": "維維樂力補素均衡高鈣配方29公克/包(體驗派樣包)", "ProductNumber": "LA04909", "EAN": null }, { "ProductName": "(外銷)維維樂-醇調養素750g(黑大蒜加強版頂級配方)", "ProductNumber": "LA08707", "EAN": "4710285010347" }, { "ProductName": "GKC鉻利穩全素減糖PLUS 1400公克/罐", "ProductNumber": "LA09203", "EAN": "4710285011252" }, { "ProductName": "巧補穩佳營養配方 800公克/罐", "ProductNumber": "LA09401", "EAN": "4710285011306" }, { "ProductName": "巧補穩佳營養配方 30公克/包", "ProductNumber": "LA09402", "EAN": null }, { "ProductName": "維維樂+鉻補養素PLUS 1400公克/罐", "ProductNumber": "LA08803", "EAN": "4710285011405" }, { "ProductName": "維奇福體康減糖Plus營養配方 840 公克/罐", "ProductNumber": "LA08607", "EAN": "4710285007682" }, { "ProductName": "維奇福體康減糖Plus營養配方20公克/包", "ProductNumber": "LA08608", "EAN": "4710285007699" }, { "ProductName": "佳倍優醇芯高纖配方 30公克*24包/盒", "ProductNumber": "LA09501", "EAN": "4710285011757" }, { "ProductName": "維奇益慎補營養配方(1) 20公克/包", "ProductNumber": "LA05607", "EAN": null }, { "ProductName": "維維樂佳慎營養配方(1) 20公克/包", "ProductNumber": "LA05608", "EAN": null }, { "ProductName": "維維樂+鉻補養素PLUS 20公克/包", "ProductNumber": "LA08804", "EAN": null }, { "ProductName": "GKC 鉻利穩 20公克/包", "ProductNumber": "LA04309", "EAN": null }, { "ProductName": "博能生機佳倍穩100鉻配方 20公克/包", "ProductNumber": "LA06205", "EAN": null }, { "ProductName": "博能生機優蛋白素A+高纖鈣配方 20公克/包", "ProductNumber": "LA06915", "EAN": null }, { "ProductName": "GKC葡萄糖胺橄欖果EX配方 810公克/罐", "ProductNumber": "LA09701", "EAN": "4710285012136" }, { "ProductName": "GKC葡萄糖胺橄欖果EX配方 20公克/包", "ProductNumber": "LA09702", "EAN": "4710285012143" }, { "ProductName": "(外銷)維奇媽媽奶粉樣品包 15公克/包", "ProductNumber": "LA04801", "EAN": "LA4822" }, { "ProductName": "(外銷)維奇金優蛋白素 15公克/包", "ProductNumber": "LA06905", "EAN": null }, { "ProductName": "(外銷)維奇葡萄糖胺全素高鈣升級配方15公克/包", "ProductNumber": "LA06403", "EAN": null }, { "ProductName": "(外銷)維奇貝兒嬰兒奶粉(1) 15公克/包", "ProductNumber": "LA07201", "EAN": "9421004014106" }, { "ProductName": "(外銷)維奇貝兒較大嬰兒奶粉(2)17.8公克/包", "ProductNumber": "LA07301", "EAN": "9421004014113" }, { "ProductName": "(STP)博能生機有機藜麥黑穀奶 800公克/罐", "ProductNumber": "LA07701-1", "EAN": "4710285008870" }, { "ProductName": "博能生機葉黃素優蛋白補養配方 800公克/罐", "ProductNumber": "LA08401", "EAN": "4710285008634" }, { "ProductName": "博能生機葉黃素優蛋白補養配方 30公克/包", "ProductNumber": "LA08402", "EAN": "4710285008689" }, { "ProductName": "佳倍優糖尿病配方禮盒5包/盒", "ProductNumber": "LA06303", "EAN": "4710285009099" }, { "ProductName": "維維樂葡萄糖胺高鈣全素養生素14包/盒", "ProductNumber": "LA06704", "EAN": "4710285009167" }, { "ProductName": "維維樂葡萄糖胺高鈣全素養生素(長條)30公克/包", "ProductNumber": "LA06705", "EAN": "4710285009174" }, { "ProductName": "維奇葡萄糖胺全素高鈣升級配方60包/盒", "ProductNumber": "LA06406", "EAN": "4710285009181" }, { "ProductName": "維奇葡萄糖胺全素高鈣升級配方(長條)30公克/包", "ProductNumber": "LA06407", "EAN": "4710285009198" }, { "ProductName": "維奇鉻活力高鈣GOLD金裝(胚芽)1480公克/罐", "ProductNumber": "LA08501", "EAN": "4710285009112" }, { "ProductName": "博能生機麩醯胺酸補養素800公克/罐", "ProductNumber": "LA08601", "EAN": "4710285008672" }, { "ProductName": "維維樂護芯黑蒜強化配方 750公克/罐", "ProductNumber": "LA08701", "EAN": "4710285009280" }, { "ProductName": "維奇醇益欣調養素(黑蒜升級) 810公克/罐", "ProductNumber": "LA08703", "EAN": "4710285009297" }, { "ProductName": "博能生機醇麴黑蒜雙效升級配方 750公克/罐", "ProductNumber": "LA08705", "EAN": "4710285006807" }, { "ProductName": "維維樂護芯黑蒜強化配方 30公克/包", "ProductNumber": "LA08702", "EAN": null }, { "ProductName": "維奇醇益欣調養素(黑蒜升級) 30公克/包", "ProductNumber": "LA08704", "EAN": null }, { "ProductName": "博能生機醇麴黑蒜雙效升級配方 30公克/包", "ProductNumber": "LA08706", "EAN": null }, { "ProductName": "GKC葡萄糖胺高鈣高纖配方 1500公克/罐", "ProductNumber": "LA06708", "EAN": "4710285009396" }, { "ProductName": "博能生機麩醯胺酸補養素40公克/包", "ProductNumber": "LA08602", "EAN": null }, { "ProductName": "維奇鉻活力高鈣GOLD金裝(胚芽)30公克/包", "ProductNumber": "LA08502", "EAN": null }, { "ProductName": "GKC 倍益力營養配方880公克/罐", "ProductNumber": "LA08603", "EAN": "4710285009488" }, { "ProductName": "GKC 倍益力營養配方40公克/包", "ProductNumber": "LA08604", "EAN": null }, { "ProductName": "GKC 慎護營養配方(1)810公克/罐", "ProductNumber": "LA05605", "EAN": "4710285009884" }, { "ProductName": "GKC 慎護營養配方(1) 30公克/包", "ProductNumber": "LA05606", "EAN": null }, { "ProductName": "維奇鉻活力粉狀營養飲品(健)900公克/罐", "ProductNumber": "LA06802", "EAN": "4710285006586" }, { "ProductName": "維奇鉻活力粉狀營養飲品(健) 36公克/包", "ProductNumber": "LA06803", "EAN": "4710285006593" }, { "ProductName": "維奇醇益欣調養素(黑蒜升級) 30公克/包(體驗派樣包)", "ProductNumber": "LA08708", "EAN": null }, { "ProductName": "維維樂護芯黑蒜強化配方 30公克/包(體驗派樣包)", "ProductNumber": "LA08709", "EAN": null }, { "ProductName": "(外銷)維奇鉻活力糖尿病配方(馬來西亞)850公克/罐", "ProductNumber": "LA09001", "EAN": "4710285010491" }, { "ProductName": "(外銷)維奇均衡高鈣配方(馬來西亞)850公克/罐", "ProductNumber": "LA09101", "EAN": "4710285010507" }, { "ProductName": "(外銷)維維樂成人補養素900公克/罐", "ProductNumber": "LA02202", "EAN": null }, { "ProductName": "(外銷)維維樂+鉻補養素 1000公克/罐", "ProductNumber": "LA04207", "EAN": null }, { "ProductName": "(外銷)博能生機醇麴A+調養素 750公克/罐(日本紅麴)", "ProductNumber": "LA04604", "EAN": null }, { "ProductName": "(外銷)博能生機關常健葡萄糖胺高鈣(無添加糖)800公克/罐", "ProductNumber": "LA05704", "EAN": null }, { "ProductName": "(外銷)佳倍優糖尿病配方40公克*24包/盒(N)", "ProductNumber": "LA06307", "EAN": null }, { "ProductName": "(外銷)維維樂葡萄糖胺高鈣全素養生素 900公克/罐", "ProductNumber": "LA06709", "EAN": null }, { "ProductName": "(外銷)GKC 雙優蛋白葉黃素配方 750公克/罐", "ProductNumber": "LA08203", "EAN": null }, { "ProductName": "(外銷)維奇醇益欣調養素(黑蒜升級) 810公克/罐", "ProductNumber": "LA08710", "EAN": null }, { "ProductName": "GKC鉻利穩全素減糖PLUS 800公克/罐", "ProductNumber": "LA09201", "EAN": "4710285010538" }, { "ProductName": "GKC鉻利穩全素減糖PLUS 30公克/包", "ProductNumber": "LA09202", "EAN": "4710285010545" }, { "ProductName": "G特營品腎後配方 30公克/包", "ProductNumber": "LA00101", "EAN": null }, { "ProductName": "維維樂佳慎雙優蛋白素18%(2) 840公克/罐", "ProductNumber": "LA01601-1", "EAN": "4711542360267" }, { "ProductName": "維維樂佳慎雙優蛋白素18%(2) 30公克/包", "ProductNumber": "LA01602-1", "EAN": "4711542360328" }, { "ProductName": "維奇益慎補全護雙優蛋白素18%(2) 900公克/罐", "ProductNumber": "LA01603-1", "EAN": "4710285010583" }, { "ProductName": "維奇益慎補全護雙優蛋白素18%(2) 30公克/包", "ProductNumber": "LA01604-1", "EAN": "4710285006449" }, { "ProductName": "GKC慎護雙優蛋白素18%(2)810公克/罐", "ProductNumber": "LA01605", "EAN": "4710285010668" }, { "ProductName": "GKC慎護雙優蛋白素18%(2)30公克/包", "ProductNumber": "LA01606", "EAN": "4710285010675" }, { "ProductName": "維奇β-藻聚醣熱帶水果營養配方880公克/罐", "ProductNumber": "LA09301", "EAN": "4710285011047" }, { "ProductName": "維奇β-藻聚醣熱帶水果營養配方20公克/包", "ProductNumber": "LA09302", "EAN": null }, { "ProductName": "維維樂倍益速抗熱帶水果營養配方880公克/罐", "ProductNumber": "LA09303", "EAN": "4710285011061" }, { "ProductName": "維維樂倍益速抗熱帶水果營養配方20公克/包", "ProductNumber": "LA09304", "EAN": null }, { "ProductName": "GKC倍益力抗三階段營養配方880公克/罐", "ProductNumber": "LA09305", "EAN": "4710285011603" }, { "ProductName": "GKC倍益力抗三階段營養配方20公克/包", "ProductNumber": "LA09306", "EAN": null }, { "ProductName": "維維樂沛體素減糖Plus營養配方 800公克/罐", "ProductNumber": "LA08605", "EAN": "4711542360847" }, { "ProductName": "維維樂沛體素減糖Plus營養配方 20公克/包", "ProductNumber": "LA08606", "EAN": "4711542360854" }, { "ProductName": "維維樂葡萄糖胺橄欖果減糖配方900公克/罐", "ProductNumber": "LA07901-1", "EAN": "4711542360946" }, { "ProductName": "維維樂葡萄糖胺橄欖果減糖配方20公克/包", "ProductNumber": "LA07903", "EAN": null }, { "ProductName": "博能生機關常健EX橄欖果萃取 810公克/罐", "ProductNumber": "LA09703", "EAN": "4710285012167" }, { "ProductName": "博能生機關常健EX橄欖果萃取 20公克/包", "ProductNumber": "LA09704", "EAN": null }, { "ProductName": "維維樂穩補營養配方試飲罐 24罐/箱", "ProductNumber": "CA02603", "EAN": "4710285008320" }, { "ProductName": "佳倍優鉻100不甜配方 24罐/箱", "ProductNumber": "CA01701", "EAN": "4710285008023" }, { "ProductName": "佳倍優鉻100不甜配方 237ml/罐", "ProductNumber": "CA01702", "EAN": "4710285008016" }, { "ProductName": "佳倍優鉻100減甜配方 24罐/箱", "ProductNumber": "CA01801", "EAN": "4711542360595" }, { "ProductName": "佳倍優鉻100減甜配方 237毫升/罐", "ProductNumber": "CA01802", "EAN": "4711542360601" }, { "ProductName": "佳倍優super佳百益無糖營養配方24罐/箱", "ProductNumber": "CA02501", "EAN": "4710285008030" }, { "ProductName": "佳倍優super佳百益無糖營養配方237毫升/罐", "ProductNumber": "CA02502", "EAN": "4710285008047" }, { "ProductName": "(STP)維維樂穩補營養配方 24罐/箱", "ProductNumber": "CA02601", "EAN": "4710285008054" }, { "ProductName": "巧補活力營養配方 24罐/箱", "ProductNumber": "CA02701", "EAN": "4710285008078" }, { "ProductName": "巧補活力營養配方 237毫升/罐", "ProductNumber": "CA02702", "EAN": "4710285008085" }, { "ProductName": "佳倍優鉻100不甜配方 8罐禮盒組", "ProductNumber": "CA01703", "EAN": "4710285008191" }, { "ProductName": "維維樂新優蛋白營養配方 24罐/箱", "ProductNumber": "CA02703", "EAN": "4710285008436" }, { "ProductName": "維維樂新優蛋白營養配方 237毫升/罐", "ProductNumber": "CA02704", "EAN": "4710285008443" }, { "ProductName": "維維樂倍益營養配方24罐/箱", "ProductNumber": "CA02301", "EAN": "4711542360908" }, { "ProductName": "維維樂倍益營養配方237毫升/罐", "ProductNumber": "CA02302", "EAN": "4711542360915" }, { "ProductName": "維維樂無糖新優蛋白配方24罐/箱", "ProductNumber": "CA03401", "EAN": "4710285010408" }, { "ProductName": "(STP)維奇無糖金優蛋白素24罐/箱", "ProductNumber": "CA03403", "EAN": "4710285010422" }, { "ProductName": "維維樂無糖新優蛋白配方237毫升/罐", "ProductNumber": "CA03402", "EAN": "4710285010415" }, { "ProductName": "(STP)維奇無糖金優蛋白素237毫升/罐", "ProductNumber": "CA03404", "EAN": "4710285010439" }, { "ProductName": "巧補穩佳營養配方24罐/箱", "ProductNumber": "CA03801", "EAN": "4710285011382" }, { "ProductName": "巧補穩佳營養配方237毫升/罐", "ProductNumber": "CA03802", "EAN": "4710285011399" }, { "ProductName": "佳倍優褐速康褐藻糖膠配方6罐禮盒組", "ProductNumber": "CA03903", "EAN": "4710285011832" }, { "ProductName": "維維樂穩補升級營養配方 24罐/箱", "ProductNumber": "CA02601-1", "EAN": "4710285008054" }, { "ProductName": "維維樂穩補升級營養配方 237毫升/罐", "ProductNumber": "CA02602-1", "EAN": "4710285008061" }, { "ProductName": "維奇鉻活力升級配方24罐/箱", "ProductNumber": "CA02604-1", "EAN": "4710285009341" }, { "ProductName": "維奇鉻活力升級配方237毫升/罐", "ProductNumber": "CA02605-1", "EAN": "4710285009358" }, { "ProductName": "維維樂倍益升級營養配方24罐/箱", "ProductNumber": "CA02301-1", "EAN": "4711542360908" }, { "ProductName": "維維樂倍益升級營養配方237毫升/罐", "ProductNumber": "CA02302-1", "EAN": "4711542360915" }, { "ProductName": "維奇寶護升級配方24罐/箱", "ProductNumber": "CA02303-1", "EAN": "4710285009655" }, { "ProductName": "維奇寶護升級配方237毫升/罐", "ProductNumber": "CA02304-1", "EAN": "4710285009662" }, { "ProductName": "佳倍優Super倍穩無糖營養配方 24罐/箱", "ProductNumber": "CA02801", "EAN": "4710285008580" }, { "ProductName": "佳倍優Super倍穩無糖營養配方 237毫升/罐", "ProductNumber": "CA02802", "EAN": "4710285008597" }, { "ProductName": "佳倍優元氣高鈣不甜無糖配方 24罐/箱", "ProductNumber": "CA02201-1", "EAN": "4711542360885" }, { "ProductName": "佳倍優元氣高鈣不甜無糖配方237ml/罐", "ProductNumber": "CA02202-1", "EAN": "4711542360892" }, { "ProductName": "佳倍優元氣高鈣減甜配方 24罐/箱", "ProductNumber": "CA02401-1", "EAN": "4711542360960" }, { "ProductName": "佳倍優元氣高鈣減甜配方 237ml/罐", "ProductNumber": "CA02402-1", "EAN": "4711542360977" }, { "ProductName": "維奇金優蛋白素 24罐/箱", "ProductNumber": "CA02705", "EAN": "4710285008818" }, { "ProductName": "維奇金優蛋白素 237毫升/罐", "ProductNumber": "CA02706", "EAN": "4710285008825" }, { "ProductName": "(STP)維奇鉻活力配方24罐/箱", "ProductNumber": "CA02604", "EAN": "4710285009341" }, { "ProductName": "(STP)維奇鉻活力配方 237毫升/罐", "ProductNumber": "CA02605", "EAN": "4710285009358" }, { "ProductName": "維奇寶護配方24罐/箱", "ProductNumber": "CA02303", "EAN": "4710285009655" }, { "ProductName": "維奇寶護配方237毫升/罐", "ProductNumber": "CA02304", "EAN": "4710285009662" }, { "ProductName": "佳倍優元氣補體無糖配方(鐵罐)24罐/箱", "ProductNumber": "CA03201", "EAN": "4710285009921" }, { "ProductName": "佳倍優元氣補體無糖配方(鐵罐)237毫升/罐", "ProductNumber": "CA03202", "EAN": "4710285009938" }, { "ProductName": "VetaVeta植系營養植物蛋白無加糖配方24罐/箱", "ProductNumber": "CA03303", "EAN": "4710285010026" }, { "ProductName": "VetaVeta植系營養植物蛋白無加糖配方237毫升/罐", "ProductNumber": "CA03304", "EAN": "4710285010033" }, { "ProductName": "佳倍優植物蛋白全素配方24罐/箱", "ProductNumber": "CA03501", "EAN": "4710285010880" }, { "ProductName": "佳倍優植物蛋白全素配方237毫升/罐", "ProductNumber": "CA03502", "EAN": "4710285010897" }, { "ProductName": "佳倍優鉻100 3EX強化配方24罐/箱", "ProductNumber": "CA03601", "EAN": "4710285010903" }, { "ProductName": "佳倍優鉻100 3EX強化配方237毫升/罐", "ProductNumber": "CA03602", "EAN": "4710285010910" }, { "ProductName": "佳倍優super智多芯無糖經典拿鐵配方24罐/箱", "ProductNumber": "CA03701", "EAN": "4710285011108" }, { "ProductName": "佳倍優super智多芯無糖經典拿鐵配方237毫升/罐", "ProductNumber": "CA03702", "EAN": "4710285011115" }, { "ProductName": "佳倍優元氣高鈣不甜無糖配方8罐禮盒組", "ProductNumber": "CA02203", "EAN": "4710285008221" }, { "ProductName": "佳倍優褐速康褐藻醣膠配方24罐/箱", "ProductNumber": "CA03901", "EAN": "4710285011481" }, { "ProductName": "佳倍優褐速康褐藻醣膠配方237毫升/罐", "ProductNumber": "CA03902", "EAN": "4710285011498" }, { "ProductName": "佳倍優植物蛋白全素配方8罐禮盒組", "ProductNumber": "CA03503", "EAN": "4710285011597" }, { "ProductName": "維維樂新優蛋白升級營養配方 24罐/箱", "ProductNumber": "CA02703-1", "EAN": "4710285008436" }, { "ProductName": "維維樂新優蛋白升級營養配方 237毫升/罐", "ProductNumber": "CA02704-1", "EAN": "4710285008443" }, { "ProductName": "維奇金優蛋白素升級配方24罐/箱", "ProductNumber": "CA02705-1", "EAN": "4710285008818" }, { "ProductName": "維奇金優蛋白素升級配方 237毫升/罐", "ProductNumber": "CA02706-1", "EAN": "4710285008825" }, { "ProductName": "維維樂無糖新優蛋白升級配方24罐/箱", "ProductNumber": "CA03401-1", "EAN": "4710285010408" }, { "ProductName": "維維樂無糖新優蛋白升級配方237毫升/罐", "ProductNumber": "CA03402-1", "EAN": "4710285010415" }, { "ProductName": "維奇無糖金優蛋白素升級配方24罐/箱", "ProductNumber": "CA03403-1", "EAN": "4710285010422" }, { "ProductName": "維奇無糖金優蛋白素升級配方237毫升/罐", "ProductNumber": "CA03404-1", "EAN": "4710285010439" }, { "ProductName": "維維樂血糖監測系統G-Power 120白機(裸)", "ProductNumber": "JD00102", "EAN": null }, { "ProductName": "維維樂血糖試紙(附針)50片/盒", "ProductNumber": "JD00201", "EAN": "4712803561300" }, { "ProductName": "維維樂採血筆", "ProductNumber": "JD00301", "EAN": null }, { "ProductName": "維維樂血糖監測系統G-Power 120白機推廣特惠組(含優惠券)", "ProductNumber": "JD00105", "EAN": "4710285007415" }, { "ProductName": "維維樂血糖監測系統G-Power 120白機+筆+優惠券/套", "ProductNumber": "JD00104", "EAN": "4712803561317" }, { "ProductName": "維維樂血糖監測系統G-Power藍機組", "ProductNumber": "JD00404", "EAN": null }, { "ProductName": "(外銷)維奇血糖監測系統G-Power 120白機附10片試紙及針", "ProductNumber": "JD00106", "EAN": "4712803563540" }, { "ProductName": "(外銷)維奇血糖試紙(附針)50片/盒(白機專用)", "ProductNumber": "JD00202", "EAN": "4712803565599" }, { "ProductName": "(STP)維維樂血糖監測系統G-Power 藍機(裸)", "ProductNumber": "JD00402", "EAN": null }, { "ProductName": "(STP)維維樂固齒敏專業護理牙膏特惠組(2大+1小)", "ProductNumber": "HA00104", "EAN": "4711542360861" }, { "ProductName": "維維樂固齒敏專業護理牙膏 126公克/盒", "ProductNumber": "HA00101", "EAN": "4014612515476" }, { "ProductName": "(STP)維維樂DM護理牙膏 51公克(裸條)", "ProductNumber": "HA00102", "EAN": null }, { "ProductName": "(STP)維維樂固齒敏專業護理牙膏 51公克/盒", "ProductNumber": "HA00103", "EAN": "4014612517227" }, { "ProductName": "維維樂固齒敏專業護理牙膏2入組", "ProductNumber": "HA00106", "EAN": "4710285011870" }, { "ProductName": "維維樂血糖監測系統G-Power 120白機組(舊換新專用)", "ProductNumber": "JD00107", "EAN": "4712803561317" }, { "ProductName": "維維樂R3活力平衡飲品PLUS(草莓奇異果口味)500毫升/瓶", "ProductNumber": "CC02004", "EAN": "4710285009204" }, { "ProductName": "維維樂R3活力平衡飲品PLUS(草莓奇異果口味)500毫升/瓶*24瓶/箱", "ProductNumber": "CC02005", "EAN": null }, { "ProductName": "維維樂R3活力平衡飲品PLUS(柚子口味)500毫升/瓶", "ProductNumber": "CC02104", "EAN": "4710285006791" }, { "ProductName": "維維樂R3活力平衡飲品PLUS(柚子口味)500毫升*24瓶/箱", "ProductNumber": "CC02105", "EAN": null }, { "ProductName": "維維樂R3活力平衡飲品PLUS(蘋果口味)500毫升/瓶", "ProductNumber": "CC02201", "EAN": "4710285009105" }, { "ProductName": "維維樂R3活力平衡飲品PLUS(蘋果口味)500毫升*24瓶/箱", "ProductNumber": "CC02202", "EAN": null }, { "ProductName": "維維樂R3幼兒活力平衡飲(草莓奇異果)350毫升*24瓶/箱", "ProductNumber": "CC02001", "EAN": null }, { "ProductName": "維維樂R3幼兒活力平衡飲(草莓奇異果)350毫升/瓶", "ProductNumber": "CC02003", "EAN": "4710285010613" }, { "ProductName": "維維樂R3幼兒活力平衡飲(柚子)350毫升*24瓶/箱", "ProductNumber": "CC02101", "EAN": null }, { "ProductName": "維維樂R3幼兒活力平衡飲(柚子)350毫升/瓶", "ProductNumber": "CC02103", "EAN": "4710285010606" }, { "ProductName": "R3 Basic ORS 電解質活力沖泡飲(草莓奇異果) 35公克/包", "ProductNumber": "CC02006", "EAN": "4710285011566" }, { "ProductName": "R3 Basic ORS 電解質活力沖泡飲(草莓奇異果) 4包/盒", "ProductNumber": "CC02007", "EAN": "4710285011573" }, { "ProductName": "R3 Basic ORS 電解質活力沖泡飲(柚子) 30公克/包", "ProductNumber": "CC02106", "EAN": "4710285011528" }, { "ProductName": "R3 Basic ORS 電解質活力沖泡飲(柚子) 4包/盒", "ProductNumber": "CC02107", "EAN": "4710285011535" }, { "ProductName": "R3 Basic ORS 電解質活力沖泡飲(蘋果) 30公克/包", "ProductNumber": "CC02203", "EAN": "4710285011542" }, { "ProductName": "R3 Basic ORS 電解質活力沖泡飲(蘋果) 4包/盒", "ProductNumber": "CC02204", "EAN": "4710285011559" }]';
        var product_obj = [];
        var today = new Date();
        var dd = String(today.getDate()).padStart(2, '0');                
        var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
        var yyyy = today.getFullYear();
        var today = yyyy + '/' + mm + '/' + dd;
        var todayWithoutSlash = yyyy + mm + dd;                            
        var needRefresh = false;
        const table_header = "項次,訂單編號,品名,產品編號,EAN,暗記,日期";
        var isStarted = false;
        // var isBegun = false;
        var itemCount = 0;
        var thisOrderId = "";
        var confirmPopup = false;
        var hasConfirmed = false;        
        window.onload=function(){
            product_obj = JSON.parse(product_json);
            // for (let i = 0; i < product_obj.length; i++) {
            //     alert(JSON.stringify(product_obj[i]));
            // }
            var dateSet = new Set();
            var currentDay = new Date();
            var dd = String(currentDay.getDate()).padStart(2, '0');
            var mm = String(currentDay.getMonth() + 1).padStart(2, '0'); //January is 0!
            var yyyy = currentDay.getFullYear();
            var currentDay = yyyy + '/' + mm + '/' + dd;            
            var v = null;
            if (localStorage.today !== currentDay) {
                // confirmPopup = false;                                                                
                for (var i = 0; i < localStorage.length; i++){
                    let t = localStorage.getItem(localStorage.key(i));
                    if (isJsonString(t)) {                            
                        v = JSON.parse(t);                
                        if (v["recordDate"] === localStorage.today) {
                            let userChoice = confirm('日前的工作紀錄尚未下載，是否下載?');
                            hasConfirmed = true;
                            if (userChoice === true) {                           
                                confirmPopup = true;
                                break;
                            }
                            
                        }
                    }
                }
                let data = "";
                if (confirmPopup) {                                        
                    for (var i = 0; i < localStorage.length; i++){
                        let t = localStorage.getItem(localStorage.key(i));
                        if (isJsonString(t)) {                            
                            v = JSON.parse(t);                
                            if (v["recordDate"] === localStorage.today) {                                                                    
                                // data += v["table_content"];                                            
                                let arr = v["table_content"].split("%0A");                        
                                let productNumber = '';
                                let ean = '';
                                for (let j = 0; j < arr.length - 1; j++) {
                                    if (typeof(arr[j]) !== 'undefined') {
                                        let arr2 = arr[j].split('%2C');
                                        for (let k = 0; k < arr2.length; k++) {
                                            data += arr2[k] + '\t' + '%2C';
                                            if (k % 4 === 2) {                                        
                                                for (let l = 0; l < product_obj.length; l++) {
                                                    if (product_obj[l].ProductName === arr2[k]) {
                                                        productNumber = product_obj[l].ProductNumber;
                                                        ean = product_obj[l].EAN;
                                                        break;
                                                    }
                                                }
                                                data += productNumber + '\t' + '%2C';
                                                data += ean + '\t' + '%2C'; 
                                                productNumber = '';
                                                ean = '';
                                            } 
                                        }                             
                                        data += '%0A';
                                    }                                        
                                }      
                            }
                        }
                    }

                    let date = new Date();
                        
                    let oprationDate = date.getFullYear().toString() + pad2(date.getMonth() + 1) + pad2(date.getDate()) + pad2(date.getHours()) + pad2(date.getMinutes()) + pad2(date.getSeconds());
                    const universalBOM = "\uFEFF";
                    let csvContent = "data:text/csv;charset=utf-8," + encodeURIComponent(universalBOM + table_header) + "%0A" + data;// v1.0.2 改中文編碼
                    
                    // "data:text/csv;charset=utf-8,%EF%BB%BF" + encodeURIComponent(csvContent);
                    var link = document.createElement("a");
                    link.download = localStorage.todayWithoutSlash + "-" + oprationDate;
                    link.href = csvContent;
                    link.click();
                }

                localStorage.today = currentDay; 
                localStorage.todayWithoutSlash = currentDaytodayWithoutSlash;                                      
                
                $('#orderIdInput').focus();
                // if (typeof(localStorage.getItem("lastUsedDate")) === "undefined") {
                //         localStorage.setItem(lastUsedDate, today);
                // } else {                        
                    
                                

                isStarted = true;                    
                localStorage.todayWithoutSlash = todayWithoutSlash;
            }

            var currentDay = new Date();
            var dd = String(currentDay.getDate()).padStart(2, '0');
            var mm = String(currentDay.getMonth() + 1).padStart(2, '0'); //January is 0!
            var yyyy = currentDay.getFullYear();
            var currentDay = yyyy + '/' + mm + '/' + dd;
            var currentDaytodayWithoutSlash = yyyy + mm + dd;

            let todayDate = new Date(today);                            


            if (typeof(Storage) !== "undefined") { 
                        
                        var _lsTotal = 0,
                            _xLen, _x;
                        for (_x in localStorage) {
                            if (!localStorage.hasOwnProperty(_x)) {
                                continue;
                            }
                            _xLen = ((localStorage[_x].length + _x.length) * 2);
                            _lsTotal += _xLen;
                            console.log(_x.substr(0, 50) + " = " + (_xLen / 1024).toFixed(2) + " KB")
                        }
                        let prevDate = todayDate.setDate(todayDate.getDate() - 5);
                        if ((_lsTotal / 1024).toFixed(2) >= 4096) {                        
                            prevDate = todayDate.setDate(todayDate.getDate() - 4);  
                        }                             
                        
                        for (var i = 0; i < localStorage.length; i++) {                                    
                            
                            let t = localStorage.getItem(localStorage.key(i));
                            if (isJsonString(t)) {
                                t = JSON.parse(t);
                                if (new Date(t["recordDate"]) <= new Date(prevDate)) {
                                    localStorage.removeItem(t["orderId"]);
                                } else {
                                    if (typeof(t['recordDate']) !== "undefined") {
                                        let test = t["table_content"].split('%0A')[0];
                                        // alert(test);
                                        // alert((test.match(new RegExp("%2C", "g") || []).length));
                                        // if ((test.match(new RegExp("%2C", "g") || []).length) !== 4) {
                                        //     localStorage.removeItem(t["orderId"]);
                                        // } else {
                                            dateSet.add(t['recordDate']);
                                        // }
                                    }
                                }                                                                        
                            }
                        }                        
                    // }   
                    localStorage.today = today;
                    
                    let dateArr = Array.from(dateSet);                                                
                    for (let s = 0; s < dateArr.length; s++) {
                        if (dateArr[s] !== today) {    
                            tpl = '<div class="btn btn-success mx-1" id="todayDataDownload" onclick="downloadDateClickEvent(' + dateArr[s].replaceAll('/', '') + ')">' + dateArr[s] + '</div>';
                            $('#btnGrp').append($(tpl));
                        }
                    }                        
                }    

            let count = 0;
            for (let i = 0; i < localStorage.length; i++){
                let t = localStorage.getItem(localStorage.key(i));
                if (isJsonString(t)) {                            
                    v = JSON.parse(t);                
                    if (v["recordDate"] === today) {                                    
                        // data += v["table_content"];                                                      
                        count++;
                    }                    
                }
            }
            
            if (count > 0) {
                $('#todayDataDownload').attr("hidden", false);   
            }                        
        }
        Number.prototype.padLeft = function(base,chr){
            var  len = (String(base || 10).length - String(this).length)+1;
            return len > 0? new Array(len).join(chr || '0')+this : this;
        }

        var now = new Date();
        var nowStr =
        now.getFullYear() + //v1.0.2 調整，將年往前提
        ("00" + (now.getMonth() + 1)).slice(-2) +
        ("00" + now.getDate()).slice(-2) +        
        ("00" + now.getHours()).slice(-2) +
        ("00" + now.getMinutes()).slice(-2) +
        ("00" + now.getSeconds()).slice(-2);
        
        var isFinished = false;
        function end() {            
            var now = new Date();
            var nowStr =
            now.getFullYear() + //v1.0.2 調整，將年往前提
            ("00" + (now.getMonth() + 1)).slice(-2) +
            ("00" + now.getDate()).slice(-2) +            
            ("00" + now.getHours()).slice(-2) +
            ("00" + now.getMinutes()).slice(-2) +
            ("00" + now.getSeconds()).slice(-2);
            console.log(nowStr);
            isFinished = true;
            isStarted = false;
            if ($('#orderIdH5').html() === "") {
                alert('此訂單無資料');
                return;
            }
            const universalBOM = "\uFEFF";
            let tpl = '<div class="btn btn-info mx-1" onclick="removeDownloadThisOrderBtn()" id="downloadThisOrderBtn"><a class="text-light" download="' + nowStr + '掃描紀錄' + '.csv" href="data:application/csv;charset=utf-8,' + universalBOM + '{table_header}%0A{table_content}"><div id="downloadOrder" onclick="updateThisStatus()">' + nowStr + '掃描紀錄' + '</div></a></div>';  // v1.0.2 改中文編碼
            let table_content = '';
            $('#todayDataDownload').attr("hidden", false);                
            let productNumber = '';
            let ean = '';
            let hint = '';
            let hasUsed = [];

            for (let i = 0; i <= $('table tr').length; i++) {
                hasUsed.push(false);
                console.log($('#field' + (i).toString()).val());
            }
            let skip = false;
            
            $.each($("td"), function (index, cell) {                
                var cellContent = cell.innerHTML;
                var td = '';                  
                
                if (index % 4 === 0) {
                    console.log(cellContent);
                    // if (!$('#tr_' + Math.trunc(index / 4).toString()).is(":visible")) {
                    //     skip = true;
                    // } else {
                        td = cellContent.split('<td>')[0];   
                    //     skip = false;
                    // }
                    // console.log($(cell).css("display"));
                    // if (!$(cell).is(":visible")) {
                    //     console.log('xxxxx');
                    //     // skip = true;
                    // } else {
                    //     console.log('pppppp');
                                                                                     
                        // skip = false;
                    // }
                } else if (index % 4 === 1) {
                    td = cellContent.split('<td>')[0];                                                                                        
                } else if (index % 4 === 2) {                                          
                    if (document.contains(document.getElementById('field' + (Math.trunc(index / 4).toString()))) && !hasUsed[(Math.trunc(index / 4))]) {
                        hasUsed[(Math.trunc(index / 4))] = true;
                        console.log((Math.trunc(index / 4)));
                        hint = $('#field' + (Math.trunc(index / 4)).toString()).val();
                    } else {
                        let x = Math.trunc(index / 4);
                        while (x <= $('table tr').length) {
                            console.log(x);                            
                            console.log('document.contains(document.getElementById("field" + (x).toString()))' + (document.contains(document.getElementById('field' + (x).toString()))).toString());
                            console.log(hasUsed[x]);
                            if (x !== lastHideIndex && document.contains(document.getElementById('field' + (x).toString())) && hasUsed[x] === false) {
                                hasUsed[x] = true;
                                console.log(hasUsed[x]);
                                break;
                            } else if (x === parseInt(lastHideIndex) + 1 && hasUsed[x] === false) {
                                hasUsed[x] = true;
                                break;
                            }
                            else
                                x++;                                
                        }
                        hint = $('#field' + (x).toString()).val();
                    }
                    console.log(hint);
                }
                if (index % 4 === 0) {
                    table_content += td + '%2C'; //Need to return contents of cell
                    table_content += $('#orderIdH5').html() + '\t' + '%2C';                                    
                } else if (index % 4 === 1) {                    
                    table_content += td + '\t' + '%2C'; //Need to return contents of cell                                                    
                    for (let i = 0; i < product_obj.length; i++) {
                        if (product_obj[i].ProductName === td) {
                            productNumber = product_obj[i].ProductNumber;
                            ean = product_obj[i].EAN;                                                        
                            break;
                        } 
                    }
                } else if (index % 4 === 2 && !skip) {                            
                    table_content += productNumber + '\t' + '%2C';                             
                    table_content += ean + '\t' + '%2C';
                    productNumber = '';
                    ean = '';
                } else if (index % 4 === 3 && !skip) {
                    table_content += hint + '\t' + '%2C';           
                    table_content += today + '%0A';
                }                
            });
            
            if (table_content === "") {
                alert('此訂單無資料');
                return;
            }  
                  

            var order = new Object(); 
            order.orderId = $('#orderIdH5').html();
            order.recordDate = localStorage.today;
            order.hasDownloaded = false;                 
            order.table_content = table_content;
            console.log("order::");
            console.log(order.orderId); 
            console.log(order.table_content);            
            let tmpStr = JSON.stringify(JSON.stringify(order)).replaceAll('\\', '');
            tmpStr = tmpStr.substring(1, tmpStr.length-1);    

            tpl = tpl.replace('{table_header}', table_header);
            tpl = tpl.replace('{table_content}', table_content);
            console.log(tpl);
            $(tpl).appendTo($('#btnGrp'));
            
            table_content = '';
            $.each($("td"), function (index, cell) {                
                var cellContent = cell.innerHTML;
                var td = '';                        
                if (index % 4 === 0 || index % 4 === 1) {
                    td = cellContent.split('<td>')[0];                                                                
                } else if (index % 4 === 2) {                                                               
                    td = $('#field' + (Math.trunc(index / 4)).toString()).val();
                }
                
                if (index % 4 === 0) {
                    table_content += td + '%2C'; //Need to return contents of cell
                    table_content += $('#orderIdH5').html() + '%2C';                                    
                } else if (index % 4 === 1) {
                    
                    table_content += td + '%2C'; //Need to return contents of cell                                
                } else if (index % 4 === 2) {                            
                    table_content += td + '%2C';
                    table_content += today + '%0A';
                }                                
            });

            let orderWithoutTab = new Object(); 
            orderWithoutTab.orderId = $('#orderIdH5').html();
            orderWithoutTab.recordDate = localStorage.today;
            orderWithoutTab.hasDownloaded = false;                 
            orderWithoutTab.table_content = table_content;
            let tmpStrWithoutTab = JSON.stringify(JSON.stringify(orderWithoutTab)).replaceAll('\\', '');
            tmpStrWithoutTab = tmpStrWithoutTab.substring(1, tmpStrWithoutTab.length - 1);    

            localStorage.setItem($('#orderIdH5').html(), tmpStrWithoutTab);               
            
            var currentDay = new Date();
            var dd = String(currentDay.getDate()).padStart(2, '0');
            var mm = String(currentDay.getMonth() + 1).padStart(2, '0'); //January is 0!
            var yyyy = currentDay.getFullYear();
            var currentDay = yyyy + '/' + mm + '/' + dd;
            var currentDaytodayWithoutSlash = yyyy + mm + dd;
            
            
            clearTable();
            $('#orderIdInput').val('');
            modifyOrderId();            
            
        }
        
        function updateThisStatus() {                   
            // $('#orderId').html("");
            // alert($('#orderIdH5').html());
            console.log($('#orderIdH5').html());
            let order = localStorage.getItem($('#orderIdH5').html());
            console.log($('#orderIdH5').html());
            // let updatedOrder = new Object(order);
            updatedOrder = JSON.parse(order);
            updatedOrder["hasDownloaded"] = true; 
            // localStorage.setItem($('#orderIdH5').html(), updatedOrder);
            localStorage.setItem(thisOrderId, JSON.stringify(JSON.parse(localStorage.getItem(thisOrderId))));
            isFinished = false;
            // alert(updatedOrder.hasDownloaded);
        }
        $(function(){
            function docReady(fn) {
                // see if DOM is already available
                if (document.readyState === "complete" || document.readyState === "interactive") {
                    // call on next available tick
                    setTimeout(fn, 1);
                } else {
                    document.addEventListener("DOMContentLoaded", fn);
                }
            } 

            docReady(function() {
                var resultContainer = document.getElementById('qr-reader-results');
                var lastResult, countResults = 0;
                
                var html5QrcodeScanner = new Html5QrcodeScanner(
                    "qr-reader", { fps: 10, qrbox: 250 });
                
                function onScanSuccess(decodedText, decodedResult) {
                    if ($('#orderIdInput').val().trim() === "") {
                        $('#orderIdInput').val(decodedText);
                    } else {
                        $('#inputBarCode').val(decodedText);
                    }
                }
                
                // Optional callback for error, can be ignored.
                function onScanError(qrCodeError) {
                    // This callback would be called in case of qr code scan error or setup error.
                    // You can avoid this callback completely, as it can be very verbose in nature.
                }
                
                html5QrcodeScanner.render(onScanSuccess, onScanError);
            });
        });
        $(document).on("click", ".delete", function(){                                
            $(this).parents("tr").remove();                 
        });

        function clearInput(id) {
            $("#" + id).val("");
        }
        
        function newRecord() {
            if ($('#orderIdH5').html() === '') {
                alert('單號未輸入!');
                return;
            }
            let inputBarCode = $('#inputBarCode').val().trim();
            if (inputBarCode === '') {
                alert('條碼未輸入!');
                return;
            }            
            if (isUpdated) {
                itemCount = incrementCount;
                isUpdated = false;                
            }
            let productName = '';
            let hint = '';
            for (let i = 0; i < product_obj.length; i++) {
                let barcode = inputBarCode.replace('-' + inputBarCode.split('-')[inputBarCode.split('-').length - 1], '');                
                if (product_obj[i].ProductNumber === barcode) {                    
                    productName = product_obj[i].ProductName;                    
                    hint = inputBarCode.split('-')[inputBarCode.split('-').length - 1];                     
                    break;
                } else if (product_obj[i].EAN === inputBarCode) {
                    productName = product_obj[i].ProductName;
                    break;
                } else {
                    if (inputBarCode.split('-').length > 1) {
                        if ((inputBarCode.split('-')[inputBarCode.split('-').length - 1]).length > 4) {
                            productName = inputBarCode.replace('-' + inputBarCode.split('-')[inputBarCode.split('-').length - 1], '');                    
                            hint = inputBarCode.split('-')[inputBarCode.split('-').length - 1];                            
                        } else {
                            productName = inputBarCode;                    
                        }                        
                    } else {
                        productName = inputBarCode;
                    }
                }                
            }
            let _productName = '';
            let _hint = '';
            let isTheSame = false; 
            $.each($("td"), function (index, cell) {                
                var cellContent = cell.innerHTML;                                        
                if (index % 4 === 1) {
                    _productName = cellContent.split('<td>')[0];                                                                
                } else if (index % 4 === 2) {                                                               
                    _hint = $('#field' + (Math.trunc(index / 4)).toString()).val();
                }
                if (_productName === productName && _hint === hint && _hint !== '') {
                    alert('已輸入相同產品!');
                    isTheSame = true;                    
                    return false;
                }
            });
            if (isTheSame) {
                $('#inputBarCode').val('');
                return;
            }
            $('table').find('tbody').append('<tr id="tr_' + (itemCount).toString() + '"><td>' + (itemCount + 1).toString() + '<td class="productName_' + (itemCount).toString() + '">' + productName + '</td>' + '<td class="col-4 col-xs-4 col-sm-4 col-md-4 col-lg-4"><input type="text" id="field' + itemCount.toString() + '" class="form-control memo" value="' + hint + '"/></td><td><div class="btn btn-danger delete">×</div></td></tr>');//<div class="input-group"> <div class="btn btn-danger px-1 reset-input" onclick="clearInput(\'field' + itemCount.toString() + '\')">×</div><div class="input-group-append"></div></div>
            $('#inputBarCode').val('');
            if ($('#field' + (itemCount).toString()).val() !== '') {
                $('#inputBarCode').focus();
            } else {
                $('#field' + (itemCount).toString()).focus();
                    document.getElementById('field' + (itemCount).toString()).addEventListener("keyup", function(event) {
                    event.preventDefault();
                    if (event.keyCode === 13) {
                        $('#inputBarCode').focus();
        
                    }
                }); 
            }
            // if ($('#enableAuto').is(":checked")) {            
            //     setTimeout(() => {
            //         if ($('#field' + (itemCount).toString()).val() !== '') {
            //             $('#inputBarCode').focus();                    
            //         }
            //         itemCount++;    
            //         }, "3000");
            // } else {
                
            // }
            itemCount++;               
        }
        var isUpdated = false;
        var incrementCount = 0;
        function newOrder() {
            thisOrderId = $('#orderIdInput').val().trim();
            clearTable();                    
            $('#orderIdInput').attr("hidden", true);                                        
            $('#ensureOrderIdBtn').attr("hidden", true);
            $('#scanOrderIdBtn').attr("hidden", true);    
            $('#orderIdH5').html(thisOrderId);
            $('#orderIdH5').attr("hidden", false);
            $("#orderIdclear").attr("hidden", false);
            $('#inputBarCode').focus();                    
            if (localStorage.getItem(thisOrderId) !== null) {
                if (confirm('此筆訂單已經存在，要繼續編輯嗎?')) {
                    isUpdated = true;
                    let data = JSON.parse(localStorage.getItem(thisOrderId));    
                    let table_content = data["table_content"];

                    if (typeof(table_content) === 'undefined') {
                        data = localStorage.getItem(thisOrderId);
                        // data = data.replaceAll("\\", "");
                        if (data[0] !== '{') {
                            data = data.substring(1, data.length - 1);
                        }
                        data = JSON.parse(data);
                        table_content = data.table_content;
                    }
                    let tableArr = splitMulti(table_content, ['%2C', '%0A']);
                    let barcode = '';
                    let hint = [];
                    let itemCount = 1;
                    let tpl = '';
                    incrementCount = parseInt(tableArr.length / 5);             
                    for (let j = 0; j < tableArr.length; j++) {
                        if (j % 5 === 0) {
                            itemCount = tableArr[j];
                            if (itemCount !== "") {
                                tpl += '<tr><td>' + (itemCount).toString() + '</td>';                            
                            }
                        } else if (j % 5 === 2) {
                            barcode = tableArr[j];
                            tpl += '<td class="barcode">' + barcode + '</td>';//.slice(0, -1)
                        } else if (j % 5 === 3) {
                            hint.push(tableArr[j]);//.slice(0, -1));
                            // $('#field' + (parseInt(itemCount - 1)).toString()).val(hint); // v1.0.1 修改再次編輯時會帶入暗記
                            tpl += '<td class="col-4 col-xs-4 col-sm-4 col-md-4 col-lg-4"><input type="text" id="field' + parseInt(itemCount - 1).toString() + '" class="form-control memo"/></td><td><div class="btn btn-danger delete">×</div></td></tr>';//<div class="input-group">   <div class="input-group-append"><div class="btn btn-danger px-1 reset-input" onclick="clearInput(\'field' + parseInt(itemCount - 1).toString() + '\')">×</div></div></div>
                        }                             
                    }   
                    $('table').find('tbody').append(tpl);
                    
                    for (let j = 0; j < hint.length; j++) {
                        $('#field' + j.toString()).val(hint[j]); // v1.0.1 修改再次編輯時會帶入暗記
                    }
                    
                    // alert(incrementCount);
                }
                        
            } 
        }
        document.getElementById("orderIdInput").addEventListener("keyup", function(event) {
        // var orderIdElement = document.getElementById('orderIdInput');
        //     var isOrderIdFocused = (document.activeElement === orderIdElement);
   
            event.preventDefault();
            if (event.keyCode === 13) {
                thisOrderId = $('#orderIdInput').val().trim();
                $("#ensureOrderIdBtn").click();
   
            }
        });

        document.getElementById("inputBarCode").addEventListener("keyup", function(event) {
        // var orderIdElement = document.getElementById('orderIdInput');
        //     var isOrderIdFocused = (document.activeElement === orderIdElement);
   
            event.preventDefault();
            if (event.keyCode === 13) {
                $("#ensureNewRecord").click();
   
            }
        });
            

        function modifyOrderId() {                    
            $('#orderIdInput').attr("hidden", false);                                                            
            $('#ensureOrderIdBtn').attr("hidden", false);
            $('#scanOrderIdBtn').attr("hidden", false);
            $('#orderIdclear').attr("hidden", true);
            $('#orderIdH5').attr("hidden", true);
        }

        var confirmReset = false;

        function confirmClearThis() {
            confirmReset = true;
            // if (!isStarted) {
            
            if (!isFinished) {
                if (confirm("您確定要重置此筆訂單的所有資料嗎?")) {
                    // localStorage.removeItem(thisOrderId);
                    clearTable();
                    modifyOrderId();
                    $('#orderIdInput').val("");                                        
                    $('#orderIdH5').html("");  
                    $('#downloadThisOrderBtn').remove();                      
                    
                    // isFinished = false;                                      
                    // let count = 0;
                    // for (var i = 0; i < localStorage.length; i++){
                    //     let t = localStorage.getItem(localStorage.key(i));
                    //     if (isJsonString(t)) {                            
                    //         v = JSON.parse(t);                
                    //         if (v["recordDate"] === today) {                                    
                    //             data += v["table_content"];                                            
                    //             count++;
                    //         }                    
                    //     }
                    // }                    
                    // if (count === 0) {                        
                    //     $('#todayDataDownload').attr("hidden", true);
                    // }
                    
                } 
            } else {
                if (confirm("刪除此筆訂單目前的資料嗎?")) {
                    clearTable();
                    modifyOrderId();
                    $('#orderIdInput').val("");                                        
                    $('#orderIdH5').html("");  
                    $('#downloadThisOrderBtn').remove();                      
                }
            }
            
        }



        
        function showScanner() {
            $('#qr-reader').attr("hidden", false);
        }

        
        function pad2(n) { return n < 10 ? '0' + n : n }

        function isJsonString(str) {
            try {
                JSON.parse(str);
            } catch (e) {
                return false;
            }
            return true;
        }
        var lastHideIndex = 0;
        $(document).on("click", ".delete", function(){                                
            $(this).parents("tr").hide();
            lastHideIndex = $(this).parents("tr").attr('id').replace('tr_', "");
            console.log(lastHideIndex);                 
        });

        function clearInput(id) {
            $("#" + id).val("");
        }
        

        function modifyOrderId() {                    
            $('#orderIdInput').attr("hidden", false);                                                            
            $('#ensureOrderIdBtn').attr("hidden", false);
            $('#scanOrderIdBtn').attr("hidden", false);
            $('#orderIdclear').attr("hidden", true);
            $('#orderIdH5').attr("hidden", true);
        }

        var confirmReset = false;        

        function downloadDateClickEvent(chosenDate) {
            
            chosenDate = chosenDate.toString().replace(/(\d{4})(\d{2})(\d{2})/g, '$1/$2/$3');
            let data = "";
            let count = 0;
            for (var i = 0; i < localStorage.length; i++){
                let t = localStorage.getItem(localStorage.key(i));
                if (isJsonString(t)) {                            
                    v = JSON.parse(t);                
                    if (v["recordDate"] === chosenDate) {                                    
                        // data += v["table_content"]; 
                        let arr = v["table_content"].split("%0A");
                        let productNumber = '';
                        let ean = '';
                        for (let j = 0; j < arr.length - 1; j++) {
                            if (typeof(arr[j]) !== 'undefined') {
                                let arr2 = arr[j].split('%2C');
                                for (let k = 0; k < arr2.length; k++) {
                                    data += arr2[k] + '\t' + '%2C';
                                    if (k % 4 === 2) {                                        
                                        for (let l = 0; l < product_obj.length; l++) {
                                            if (product_obj[l].ProductName === arr2[k]) {
                                                productNumber = product_obj[l].ProductNumber;
                                                ean = product_obj[l].EAN;
                                                break;
                                            }
                                        }
                                        data += productNumber + '\t' + '%2C';
                                        data += ean + '\t' + '%2C'; 
                                        productNumber = '';
                                        ean = '';
                                    } 
                                }                             
                                data += '%0A';
                            }                                        
                        }      
                        count++;
                    }                    
                }
            }

            if (count === 0) {
                alert("當前無資料");
                return;
            }
            let date = new Date();
                                
            let oprationDate = date.getFullYear().toString() + pad2(date.getMonth() + 1) + pad2(date.getDate()) + pad2(date.getHours()) + pad2(date.getMinutes()) + pad2(date.getSeconds());

            // let csvContent = "data:text/csv;charset=utf-8," + table_header + "%0A" + data;//.map(e => e.join(",")).join("\n");    
            const universalBOM = "\uFEFF";
            let csvContent = "data:text/csv;charset=utf-8," + encodeURIComponent(universalBOM + table_header) + "%0A" + data;// v1.0.2 改中文編碼
            
            var link = document.createElement("a");
            chosenDate = chosenDate.replaceAll('/', '');
            link.download = chosenDate + "-" + oprationDate;                        
            link.href = csvContent;
            link.click();            
        }
        

        function clearTable() {
            isFinished = false;
            $('tr td').remove();
            itemCount = 0;                                    
        }

        
        function showScanner() {
            $('#qr-reader').attr("hidden", false);
        }

        function removeDownloadThisOrderBtn() {            
            localStorage.setItem(thisOrderId, JSON.stringify(JSON.parse(localStorage.getItem(thisOrderId))));//JSON.parse
            $('#orderIdH5').html("");            
            $("#downloadThisOrderBtn").remove();
        }
        function splitMulti(str, tokens){
           var tempChar = tokens[0]; // We can use the first token as a temporary join character
            for(var i = 1; i < tokens.length; i++){
                str = str.split(tokens[i]).join(tempChar);
            }
            str = str.split(tempChar);
            return str;
        }
    </script>
    <style>
        #fixedButtons {
            position: fixed;
            bottom: 10px;
            right: 10px; 
        }
    </style>
</body>
</html>
